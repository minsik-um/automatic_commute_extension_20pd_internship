# automatic_commute_2020_pd_intern
2020 공공데이터 청년인턴십 자동 출퇴근 매크로입니다. 자유롭게 수정해서 쓰세요

<a href="install.xpi">설치하려면 클릭</a>

## 설명
### 대상
2020 공공데이터 청년인턴

### 플랫폼
파이어폭스, 크롬 웹 확장 프로그램

### 버전
1.2

### 사용방법
1. [출퇴근 웹사이트](https://dt20chk.hyosungitx.com/) 에 접속합니다.
2. 설정 페이지에 나오는 정보를 자신에 맞게 입력합니다.
3. 출퇴근 웹사이트를 새로고침하여 다시 접속하면 매크로가 실행됩니다.
4. 이후엔 웹사이트 접속 시 매크로가 바로 실행됩니다.

### 주의사항
- 해당 플러그인은 반복된 입력의 자동화를 해줄 뿐입니다. **코로나로 인한 증상 있을 시 플러그인 삭제 후 코로나 증상 입력을 권장**드립니다.

### 업데이트 계획(예정)
- 모바일 지원

## 릴리즈 노트
### 2020-08-16, 1.2
1. option page에서 비밀번호 input을 password type으로 변경, 설명 문구 수정
2. option page 초기값이 뜨지 않도록 수정

### 2020-09-15, 1.1
1. 코드 리팩토링
2. 출/퇴근 구분 시간을 12시로 조정

### 2020-09-14, 1.0
초기 업로드.

## 개발 과정
### 개발 동기
처음에 안드로이드 모바일로 출퇴근 사이트에 접속해서 출퇴근 처리를 하려니, 서명 부분에서 `<input>` 태그가 눈에 보이는 것과 다른 위치에 있는 등 불편함이 있었습니다. 3개월 가까이 하루 2번 이용할 출퇴근 사이트의 불편함을 해결하고 싶었습니다.

또한 2020 공공데이터 청년인턴십 특성상 근무 내 개인 공부할 여유가 있으므로, 무언가 프로젝트를 수행하고자 했습니다.

### 시행 착오
Javascript로 ui가 불편한 부분은 자동 입력하는 게 목표입니다. 게다가 출퇴근 절차는 여러 url을 순차적으로 이동하면서 처리합니다. 사이트가 변해도 Javascript를 계속 넣어서, 매크로 처리를 모든 url에 걸쳐 실행하는 게 어려웠습니다.

#### `<iframe>` 태그 사용과 크로스 도메인 방지 정책
처음엔 따로 HTML 문서를 만들고 Javascript를 삽입한 다음, `<iframe>` 태그에 출퇴근 사이트를 연결하여 수정하고자 했습니다. 하지만 [크로스 도메인 방지 정책](https://en.wikipedia.org/wiki/Same-origin_policy)에 의해 `<iframe>` 내부 콘텐츠를 수정할 수 없었습니다.

#### 크롬 확장프로그램 플랫폼
크롬 웹 플러그인에 Javascript를 넣어두고, 출퇴근 사이트 호스트에 대한 권한을 유저에게 얻어 수정하는 방법을 사용했습니다. 출퇴근 사이트의 url을 웹 플러그인이 감지하여 스크립트를 넣어줍니다. Javascript는 한 파일이며 Url을 분기로 다른 매크로를 실행합니다.

그러나 크롬 웹 플러그인은 PC에서만 작동했습니다. 출근은 9시 이전에 컴퓨터를 켜서 하면 되지만, 퇴근 할려면 6시 이후까지 자리에 남아있다가 컴퓨터로 처리해야 했습니다. 하지만 보통 5시 55분 쯤에 자리에서 일어나 퇴근하는 상황이 많으므로 모바일로 퇴근하는 사례가 많았습니다. 모바일 지원의 필요성이 생겼습니다.

안드로이드 'kiwi' 브라우저에서 크롬 확장 프로그램 설치가 가능하다고 하여 설치했지만, 자동 입력은 커녕 처음에 나와야 할 옵션 페이지도 나오지 않았습니다. 공식 지원이 아니므로 명확한 해결책이 없었고, 개발자모드로 봐도 어떤 오류 메시지도 나오지 않아 수정이 어려웠습니다.

HTTP 요청 형식을 알아내면 어떻게 안될까? 생각했지만, HTTP 요청은 `cryptoInfo`처럼 암호화된 데이터로 요청을 주고 받아 형식을 알 수 없었습니다. 무엇보다 내부 JS 코드를 긁어 수정하는 순간 출/퇴근 처리가 정상 처리되었는지 보장할 수 없기에 건들 수 없습니다.

하는 수 없이 포ㄱ.... 할 줄 알았냐!

#### Firefox add-on 플랫폼
firefox browser의 add-on은 android 브라우저 호환을 공식 지원합니다. 바로 해당 브라우저 버전으로 add-on을 수정했습니다.

